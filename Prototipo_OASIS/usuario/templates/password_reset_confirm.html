{% extends 'base.html' %} 
{% load widget_tweaks %} {# Necesario para aplicar estilos de Bootstrap #}

{% block title %}Ingresar Nueva Contraseña{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4 shadow-lg border-0 bg-white">
                <h2 class="card-title text-center mb-4 text-success">Establecer Nueva Contraseña</h2>
                
                {# Comprueba si el token es válido #}
                {% if validlink %}
                    <p class="text-center text-muted mb-4">
                        Por favor, ingresa tu nueva contraseña a continuación.
                    </p>

                    <form method="post">
                        {% csrf_token %}
                        
                        {# Itera sobre el formulario (campos new_password1 y new_password2) #}
                        {% for field in form %}
                        <div class="mb-3">
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}:</label>
                            {# Aplica la clase 'form-control' de Bootstrap #}
                            {{ field|add_class:"form-control" }}
                            
                            {# Muestra errores debajo del campo #}
                            {% for error in field.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                        
                        {# Muestra errores generales del formulario (si los hay) #}
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <button type="submit" class="btn btn-success w-100 mt-3 fw-bold">
                            Cambiar mi contraseña
                        </button>
                    </form>
                
                {# Si el token o el enlace no es válido (ej. ya se usó) #}
                {% else %}
                    <div class="alert alert-danger text-center" role="alert">
                        El enlace de restablecimiento ha expirado o no es válido. 
                        Por favor, solicita un nuevo restablecimiento de contraseña.
                    </div>
                {% endif %}
            </div>
            <div class="text-center mt-3">
                <a href="{% url 'auth:login' %}" class="text-success small">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>
</div>
{% endblock content %}